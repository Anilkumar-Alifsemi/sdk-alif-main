

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Linker &mdash; Alif SDK Documentation - v1.1</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />

  
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=56dcb7b8"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../_static/js/custom.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="Modules" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980b9" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../connectivity/index.html">Connectivity</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Modules</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Linker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#technical-details">Technical Details</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#exception-tables-and-arm-eabi-limitations">Exception Tables and ARM EABI Limitations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-call-range-issues">Function Call Range Issues</a></li>
<li class="toctree-l4"><a class="reference internal" href="#linker-warning-issues">Linker Warning Issues</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980b9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SDK documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Modules</a></li>
      <li class="breadcrumb-item active">Linker</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/modules/linker/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="linker">
<span id="alif-linker-workarounds"></span><h1>Linker<a class="headerlink" href="#linker" title="Link to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>This Zephyr module provides linker script fragments and build system integration to address specific issues when building
firmware with LLVM/Clang. The main problems addressed are:</p>
<ol class="arabic simple">
<li><p>Unwanted exception tables generated by Clang even when exceptions are disabled</p></li>
<li><p>ARM EABI relocation limitations with <code class="docutils literal notranslate"><span class="pre">.ramfunc</span></code> sections</p></li>
<li><p>Lack of proper support for the <code class="docutils literal notranslate"><span class="pre">long_call</span></code> attribute in Clang</p></li>
<li><p>Symbol table placement warnings from LLVM’s linker</p></li>
</ol>
</section>
<section id="features">
<h2>Features<a class="headerlink" href="#features" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Automatic discard of exception table sections to prevent linker errors</p></li>
<li><p>Integration with Zephyr’s build system via Kconfig options</p></li>
<li><p>Fixes for symbol table placement warnings</p></li>
</ul>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Link to this heading"></a></h2>
<p>This module is automatically enabled when using the LLVM toolchain with Zephyr when exceptions are disabled.
To manually control its behavior, you can set the following Kconfig options in your project’s <code class="docutils literal notranslate"><span class="pre">prj.conf</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Main configuration option
CONFIG_ALIF_LINKER_WORKAROUNDS=y  # Enable all workarounds

# Granular control over specific workarounds
CONFIG_ALIF_DISCARD_EXCEPTION_TABLES=y  # Discard exception tables (.ARM.exidx)
CONFIG_ALIF_FIX_SYMBOL_WARNINGS=y      # Fix symbol table placement warnings
</pre></div>
</div>
<p>For debug builds, you can keep the unwinding information while still discarding the exception tables that cause linker errors:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_ALIF_DISCARD_EXCEPTION_TABLES=y  # Still needed to avoid linker errors
</pre></div>
</div>
<p>For optimal results with either configuration, also add these compiler flags:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_EXCEPTIONS=n  # Disable C++ exceptions
</pre></div>
</div>
</section>
<section id="technical-details">
<h2>Technical Details<a class="headerlink" href="#technical-details" title="Link to this heading"></a></h2>
<section id="exception-tables-and-arm-eabi-limitations">
<h3>Exception Tables and ARM EABI Limitations<a class="headerlink" href="#exception-tables-and-arm-eabi-limitations" title="Link to this heading"></a></h3>
<p>The ARM EABI specification defines a relocation type called <code class="docutils literal notranslate"><span class="pre">R_ARM_PREL31</span></code> which is used for exception handling tables
(<code class="docutils literal notranslate"><span class="pre">.ARM.exidx</span></code> sections). This relocation has a limited range of ±1GB from the call site.</p>
<p>LLVM/Clang generates these exception tables for all functions by default, even when exceptions are disabled with
<code class="docutils literal notranslate"><span class="pre">-fno-exceptions</span></code>. This is a known issue and differs from GCC’s behavior.</p>
<section id="alif-hardware-memory-layout">
<h4>Alif Hardware Memory Layout<a class="headerlink" href="#alif-hardware-memory-layout" title="Link to this heading"></a></h4>
<p>The Alif SoC architecture uses a memory layout where MRAM (Magnetoresistive RAM) and TCM (Tightly Coupled Memory)
are placed at addresses that are very far apart in the memory map:</p>
<ul class="simple">
<li><p><strong>MRAM</strong>: Located at address ranges starting at 0x80000000</p></li>
<li><p><strong>TCM</strong>: Located at much lower addresses, typically around 0x00000000 - 0x00FFFFFF</p></li>
</ul>
<p>When code is placed in MRAM and RAM functions (using the <code class="docutils literal notranslate"><span class="pre">.ramfunc</span></code> section) are placed in TCM, the distance between them
can be well over 1GB. This causes linker errors because the <code class="docutils literal notranslate"><span class="pre">R_ARM_PREL31</span></code> relocations cannot span this distance.</p>
<p>Error messages typically look like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ld.lld: error: &lt;internal&gt;:(.ARM.exidx+0x0): relocation R_ARM_PREL31 out of range: -1610651068 is not in [-1073741824, 1073741823]; references section &#39;.ramfunc&#39;
</pre></div>
</div>
<p><strong>Solution</strong>: The <code class="docutils literal notranslate"><span class="pre">discard_exception_tables.ld</span></code> script addresses this issue by discarding these unwanted exception tables when
the <code class="docutils literal notranslate"><span class="pre">CONFIG_ALIF_DISCARD_EXCEPTION_TABLES</span></code> option is enabled.</p>
</section>
<section id="when-exception-tables-can-be-kept">
<h4>When Exception Tables Can Be Kept<a class="headerlink" href="#when-exception-tables-can-be-kept" title="Link to this heading"></a></h4>
<p>It’s important to note that discarding exception tables is only necessary when your application has code that spans across
memory regions that are far apart in the address space (like MRAM and TCM). If your application code stays entirely within
a single memory region, such as:</p>
<ul class="simple">
<li><p>All code remains in MRAM (no <code class="docutils literal notranslate"><span class="pre">.ramfunc</span></code> sections)</p></li>
<li><p>All code remains in I/DTCM (a fully RAM-resident application)</p></li>
</ul>
<p>Then the exception tables can be kept without causing linker errors, because all the relocations will be within the ±1GB
range limit. In these cases, you can safely disable <code class="docutils literal notranslate"><span class="pre">CONFIG_ALIF_DISCARD_EXCEPTION_TABLES</span></code> if you need the exception
tables for other purposes, such as debugging or exception handling.</p>
</section>
</section>
<section id="function-call-range-issues">
<h3>Function Call Range Issues<a class="headerlink" href="#function-call-range-issues" title="Link to this heading"></a></h3>
<section id="lack-of-long-call-attribute-support">
<h4>Lack of <code class="docutils literal notranslate"><span class="pre">long_call</span></code> Attribute Support<a class="headerlink" href="#lack-of-long-call-attribute-support" title="Link to this heading"></a></h4>
<p>Unlike GCC, LLVM/Clang does not properly support the <code class="docutils literal notranslate"><span class="pre">__attribute__((long_call))</span></code> attribute for ARM targets.
This attribute is meant to ensure that function calls use a calling sequence that can reach any memory address,
but Clang ignores it.</p>
</section>
<section id="linker-veneers-as-an-alternative">
<h4>Linker Veneers as an Alternative<a class="headerlink" href="#linker-veneers-as-an-alternative" title="Link to this heading"></a></h4>
<p>Instead of relying on the <code class="docutils literal notranslate"><span class="pre">long_call</span></code> attribute, modern ARM linkers (including LLVM’s lld) use a technique called
“veneers” or “trampolines” to handle calls that exceed the normal branch instruction range. When the linker detects
that a function call target is too far away for a direct branch instruction, it automatically inserts a small piece
of code (the veneer) that uses a longer-range calling sequence.</p>
<p>How veneers work:</p>
<ol class="arabic simple">
<li><p><strong>Detection</strong>: During linking, the linker calculates the distance between call sites and their targets</p></li>
<li><p><strong>Veneer Insertion</strong>: If a call exceeds the branch range (±16MB for ARM Thumb branches), the linker inserts a veneer</p></li>
<li><p><strong>Redirection</strong>: The original call is redirected to the veneer instead of directly to the target function</p></li>
<li><p><strong>Long Jump</strong>: The veneer uses a PC-relative load or absolute addressing to reach the actual target</p></li>
</ol>
<p>This approach is more efficient than using <code class="docutils literal notranslate"><span class="pre">long_call</span></code> for every function, as veneers are only inserted where needed.
However, it doesn’t solve the issue with exception tables, which still require the workarounds provided by this module.</p>
</section>
</section>
<section id="linker-warning-issues">
<h3>Linker Warning Issues<a class="headerlink" href="#linker-warning-issues" title="Link to this heading"></a></h3>
<section id="symbol-table-placement-warnings">
<h4>Symbol Table Placement Warnings<a class="headerlink" href="#symbol-table-placement-warnings" title="Link to this heading"></a></h4>
<p>LLVM’s linker (ld.lld) generates warnings about symbol table placement that don’t occur with other linkers:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ld.lld: warning: &lt;internal&gt;:(.symtab) is being placed in &#39;.symtab&#39;
ld.lld: warning: &lt;internal&gt;:(.shstrtab) is being placed in &#39;.shstrtab&#39;
ld.lld: warning: &lt;internal&gt;:(.strtab) is being placed in &#39;.strtab&#39;
</pre></div>
</div>
<p>These warnings are harmless but can clutter build output.</p>
<p><strong>Solution</strong>: The <code class="docutils literal notranslate"><span class="pre">symbol_tables.ld</span></code> script addresses these warnings by explicitly defining these sections with the <code class="docutils literal notranslate"><span class="pre">(INFO)</span></code> attribute,
telling the linker these are informational sections that don’t need to be loaded into memory.
This fix is enabled when the <code class="docutils literal notranslate"><span class="pre">CONFIG_ALIF_FIX_SYMBOL_WARNINGS</span></code> option is set.</p>
</section>
<section id="known-remaining-warnings">
<h4>Known Remaining Warnings<a class="headerlink" href="#known-remaining-warnings" title="Link to this heading"></a></h4>
<p>When using LLVM’s linker, you may still see this warning:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ld.lld: warning: ignoring memory region assignment for non-allocatable section &#39;.last_section&#39;
</pre></div>
</div>
<p>The warning occurs because Zephyr’s linker script assigns the <code class="docutils literal notranslate"><span class="pre">.last_section</span></code> to a memory region, but this section
is marked as non-allocatable. Since this section doesn’t need memory allocation, the warning is harmless and can be
safely ignored. Future versions of LLVM may fix this issue.</p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Alif Semiconductor.
      <span class="lastupdated">Last updated on Sep 12, 2025.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>